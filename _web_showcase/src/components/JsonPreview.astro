---
import NeoButton from "./NeoButton.astro"
import { ICONS } from "../lib/icons"

const props = Astro.props
---
<div id="json-wrapper">
  <NeoButton
    id="close-btn" class="neo-button-sm close block ml-auto"><Fragment set:html={ICONS.close} /></NeoButton>
  <pre>
    <code id="json-output"></code>
  </pre>
</div>

<script>
  import Prism from "prismjs";
  import "prismjs/components/prism-json";

  const wrapper = document.querySelector("#json-wrapper") as HTMLElement;
  const target = document.querySelector("#json-output") as HTMLElement;
  const closeBtn = document.querySelector('#close-btn') as HTMLElement;

  const scrollPrecise = (target: Element | null) => {
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        target?.scrollIntoView({
          block: "start",
          behavior: 'smooth' }
        )
      })
    })
  }

  window.addEventListener('jsoon:show-events', (e: any) => {
    const data = JSON.stringify(e.detail, null,2) as string;
    const dataFormatted = Prism.highlight(data, Prism.languages.json, "json") as string;
    wrapper.classList.remove("active");
    target.innerHTML = dataFormatted;
    wrapper.classList.add("active");
    let submitBtn = document.querySelector('button[type="submit"]');
    scrollPrecise(submitBtn)
  })

  closeBtn?.addEventListener('click', () => {
   wrapper.classList.remove("active") 
   window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
</script>

